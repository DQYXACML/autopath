# ç§å­é©±åŠ¨æ¨¡ç³Šæµ‹è¯•ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

ç§å­é©±åŠ¨æ¨¡ç³Šæµ‹è¯• (Seed-Driven Fuzzing) æ˜¯ Layer 1 çš„æ ¸å¿ƒåŠŸèƒ½,é€šè¿‡ä½¿ç”¨å·²çŸ¥çš„æ”»å‡»å‚æ•°ä½œä¸ºç§å­,åœ¨å…¶é™„è¿‘ç”Ÿæˆå˜å¼‚å€¼,æå¤§æå‡äº†æ¨¡ç³Šæµ‹è¯•çš„æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚

## æ ¸å¿ƒä¼˜åŠ¿

### å¯¹æ¯”ä¼ ç»Ÿæ–¹æ³•

**ä¼ ç»Ÿéšæœºæ¨¡ç³Šæµ‹è¯•**:
- æµ‹è¯•ç»„åˆæ•°: 120
- æœ‰æ•ˆç»“æœ: 0-2 ä¸ª
- è€—æ—¶: 2-5ç§’
- é—®é¢˜: ç›²ç›®æµ‹è¯•,æ•ˆç‡ä½ä¸‹

**ç§å­é©±åŠ¨æ¨¡ç³Šæµ‹è¯•**:
- æµ‹è¯•ç»„åˆæ•°: 300
- æœ‰æ•ˆç»“æœ: é¢„è®¡ 10-30 ä¸ª
- è€—æ—¶: 5-10ç§’
- ä¼˜åŠ¿: èšç„¦æ”»å‡»å‚æ•°é™„è¿‘,ç²¾å‡†é«˜æ•ˆ

### å˜å¼‚ç­–ç•¥

ç§å­é©±åŠ¨ç”Ÿæˆå™¨é‡‡ç”¨ä¸‰å±‚åŠ æƒç­–ç•¥:

1. **ç§å­é©±åŠ¨å˜å¼‚ (70%)**:
   - æ•°å€¼ç±»å‹: ç”Ÿæˆ Â±1%, Â±2%, Â±5%, Â±10%, Â±20%, Â±50%, Â±100% çš„å˜å¼‚
   - åœ°å€ç±»å‹: bitflip (ç¿»è½¬1-2ä¸ªæ¯”ç‰¹)ã€nearby (Â±1, Â±10, Â±100, Â±1000)
   - å­—èŠ‚ç±»å‹: å­—èŠ‚çº§ç¿»è½¬

2. **éšæœºæ¢ç´¢ (20%)**:
   - ä½¿ç”¨åŸºç¡€éšæœºç”Ÿæˆå™¨æ¢ç´¢å…¶ä»–å¯èƒ½æ€§

3. **è¾¹ç•Œå€¼æµ‹è¯• (10%)**:
   - 0, 1, 2, MAX ç­‰è¾¹ç•Œå€¼

## é…ç½®æ–¹æ³•

### 1. å‡†å¤‡ç§å­æ•°æ®

ä»æ”»å‡»äº¤æ˜“ä¸­æå–å…³é”®å‚æ•°å€¼ã€‚ä¾‹å¦‚ MIC æ”»å‡»:
- å‚æ•°0 (amount): `1000000000000000000` (1 ETH)
- å‚æ•°1 (address): `0x5FC8d32690cc91D4c39d9d3abcBD16989F875707`

### 2. é…ç½® JSON æ–‡ä»¶

åœ¨ä¸å˜é‡é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  `seed_config` éƒ¨åˆ†:

```json
{
  "fuzzing_config": {
    "enabled": true,
    "threshold": 0.7,
    "max_variations": 300,
    "workers": 8,
    "seed_config": {
      "enabled": true,
      "attack_seeds": {
        "0": ["1000000000000000000"],
        "1": ["0x5FC8d32690cc91D4c39d9d3abcBD16989F875707"]
      },
      "range_config": {
        "numeric_range_percent": [1, 2, 5, 10, 20, 50, 100],
        "address_mutation_types": ["original", "bitflip_1", "bitflip_2", "nearby"],
        "boundary_exploration": true
      },
      "weights": {
        "seed_based": 0.7,
        "random": 0.2,
        "boundary": 0.1
      }
    }
  }
}
```

### 3. å‚æ•°è¯´æ˜

#### attack_seeds
- é”®: å‚æ•°ç´¢å¼• (ä»0å¼€å§‹)
- å€¼: è¯¥å‚æ•°çš„æ”»å‡»å€¼åˆ—è¡¨

æ”¯æŒå¤šç§æ•°æ®ç±»å‹:
```json
{
  "0": [1000000000000000000],           // æ•°å€¼
  "1": ["0x5FC8d32690cc91D4c39d9d3abcBD16989F875707"],  // åœ°å€
  "2": [true],                           // å¸ƒå°”
  "3": ["0xabcdef..."]                   // å­—èŠ‚
}
```

#### numeric_range_percent
æ•°å€¼ç±»å‹çš„å˜å¼‚ç™¾åˆ†æ¯”åˆ—è¡¨ã€‚ä¾‹å¦‚ `[1, 5, 10]` è¡¨ç¤º:
- ç§å­å€¼ 1000 â†’ ç”Ÿæˆ 1010 (1000 + 1%), 990 (1000 - 1%)
- ç§å­å€¼ 1000 â†’ ç”Ÿæˆ 1050 (1000 + 5%), 950 (1000 - 5%)
- ç§å­å€¼ 1000 â†’ ç”Ÿæˆ 1100 (1000 + 10%), 900 (1000 - 10%)

#### address_mutation_types
åœ°å€ç±»å‹çš„å˜å¼‚æ–¹å¼:
- `original`: ä¿ç•™åŸå§‹åœ°å€
- `bitflip_1`: ç¿»è½¬å•ä¸ªæ¯”ç‰¹
- `bitflip_2`: ç¿»è½¬ä¸¤ä¸ªæ¯”ç‰¹
- `nearby`: ç”Ÿæˆé™„è¿‘åœ°å€ (Â±1, Â±10, Â±100, Â±1000)

#### weights
å„ç­–ç•¥çš„æƒé‡é…ç½®:
- `seed_based`: ç§å­é©±åŠ¨å˜å¼‚å æ¯” (æ¨è 0.7)
- `random`: éšæœºæ¢ç´¢å æ¯” (æ¨è 0.2)
- `boundary`: è¾¹ç•Œå€¼æµ‹è¯•å æ¯” (æ¨è 0.1)

## ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯1: MIC Token æ”»å‡»å¤ç°

1. **å‡†å¤‡é…ç½®æ–‡ä»¶** (`pkg/invariants/configs/mic_seed.json`):

```json
{
  "fuzzing_config": {
    "seed_config": {
      "enabled": true,
      "attack_seeds": {
        "0": ["1000000000000000000"],
        "1": ["0x5FC8d32690cc91D4c39d9d3abcBD16989F875707"]
      }
    }
  }
}
```

2. **å¯åŠ¨ Monitor**:

```bash
cd autopath
./monitor -rpc ws://localhost:8545 \
  -config pkg/invariants/configs/mic_seed.json \
  -webhook http://localhost:9000/alerts \
  -oracle.enabled \
  -oracle.module 0x<ParamCheckModuleåœ°å€> \
  -oracle.pk 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
```

3. **æ‰§è¡Œæ”»å‡»æµ‹è¯•**:

```bash
export PRIVATE_KEY=0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d
forge script test/MIC/scripts/ExploitLocal.s.sol \
  --rpc-url http://127.0.0.1:8545 \
  --broadcast -vvvv
```

4. **è§‚å¯Ÿ Fuzzing ç»“æœ**:

Monitor æ—¥å¿—ä¼šæ˜¾ç¤º:
```
[Fuzzer] ğŸŒ± Using seed-driven generation with 2 attack seeds
[SeedGen] Param #0: Generated 45 variations (type=uint256)
[SeedGen] Param #1: Generated 28 variations (type=address)
[SeedGen] Total combinations generated: 300
[Fuzzer] Found 15 valid combinations
```

### åœºæ™¯2: æ— ç§å­æ•°æ®çš„å›é€€

å¦‚æœæŸä¸ªå‚æ•°æ²¡æœ‰ç§å­æ•°æ®,ç³»ç»Ÿä¼šè‡ªåŠ¨å›é€€åˆ°éšæœºç”Ÿæˆ:

```json
{
  "attack_seeds": {
    "0": ["1000000000000000000"]
    // å‚æ•°1 æ²¡æœ‰ç§å­,ä¼šä½¿ç”¨éšæœºç”Ÿæˆ
  }
}
```

æ—¥å¿—è¾“å‡º:
```
[SeedGen] Param #0 has 1 seed(s)
[SeedGen] No seed for param #1, using base generator
```

### åœºæ™¯3: ç¦ç”¨ç§å­é©±åŠ¨

å¦‚æœéœ€è¦å›é€€åˆ°ä¼ ç»Ÿéšæœºæ¨¡ç³Šæµ‹è¯•:

```json
{
  "seed_config": {
    "enabled": false
  }
}
```

æˆ–å®Œå…¨ç§»é™¤ `seed_config` é…ç½®ã€‚

## å˜å¼‚ç¤ºä¾‹

### æ•°å€¼å‚æ•°å˜å¼‚

**ç§å­å€¼**: `1000000000000000000` (1 ETH)

**ç”Ÿæˆçš„å˜å¼‚å€¼** (éƒ¨åˆ†):
```
1010000000000000000  (1000000000000000000 + 1%)
 990000000000000000  (1000000000000000000 - 1%)
1050000000000000000  (1000000000000000000 + 5%)
 950000000000000000  (1000000000000000000 - 5%)
1100000000000000000  (1000000000000000000 + 10%)
 900000000000000000  (1000000000000000000 - 10%)
1500000000000000000  (1000000000000000000 + 50%)
 500000000000000000  (1000000000000000000 - 50%)
2000000000000000000  (1000000000000000000 + 100%)
1000000000000000001  (1000000000000000000 + 1)
 999999999999999999  (1000000000000000000 - 1)
1000000000000000010  (1000000000000000000 + 10)
```

### åœ°å€å‚æ•°å˜å¼‚

**ç§å­å€¼**: `0x5FC8d32690cc91D4c39d9d3abcBD16989F875707`

**ç”Ÿæˆçš„å˜å¼‚å€¼** (éƒ¨åˆ†):
```
0x5FC8d32690cc91D4c39d9d3abcBD16989F875707  (original)
0x5FC8d32690cc91D4c39d9d3abcBD16989F875706  (bitflip æ¯”ç‰¹0)
0x5FC8d32690cc91D4c39d9d3abcBD16989F875705  (bitflip æ¯”ç‰¹1)
0x5FC8d32690cc91D4c39d9d3abcBD16989F875708  (nearby +1)
0x5FC8d32690cc91D4c39d9d3abcBD16989F875711  (nearby +10)
0x5FC8d32690cc91D4c39d9d3abcBD16989F8756A7  (nearby +100)
```

## æ€§èƒ½è°ƒä¼˜

### é˜ˆå€¼è°ƒæ•´

æ ¹æ®éœ€æ±‚è°ƒæ•´ç›¸ä¼¼åº¦é˜ˆå€¼:

```json
{
  "threshold": 0.7,        // ä¸»é˜ˆå€¼ (fuzzing è¿‡æ»¤)
  "min_similarity": 0.65   // ä¿å­˜é˜ˆå€¼ (ç»“æœè¾“å‡º)
}
```

**æ¨èé…ç½®**:
- ä¸¥æ ¼æ¨¡å¼: `threshold: 0.8, min_similarity: 0.75`
- å¹³è¡¡æ¨¡å¼: `threshold: 0.7, min_similarity: 0.65`
- å®½æ¾æ¨¡å¼: `threshold: 0.6, min_similarity: 0.55`

### å˜å¼‚æ•°é‡è°ƒæ•´

æ ¹æ®å‚æ•°å¤æ‚åº¦è°ƒæ•´æœ€å¤§å˜å¼‚æ•°:

```json
{
  "max_variations": 300  // æ¨è 200-500
}
```

**é€‰æ‹©æŒ‡å—**:
- ç®€å•æ”»å‡» (1-2ä¸ªå‚æ•°): 200
- ä¸­ç­‰å¤æ‚åº¦ (3-4ä¸ªå‚æ•°): 300
- é«˜å¤æ‚åº¦ (5+ä¸ªå‚æ•°): 500

### æƒé‡å¾®è°ƒ

æ ¹æ®æ”»å‡»ç‰¹å¾è°ƒæ•´ç­–ç•¥æƒé‡:

```json
{
  "weights": {
    "seed_based": 0.8,  // å¦‚æœæ”»å‡»å‚æ•°éå¸¸å…³é”®
    "random": 0.15,     // å‡å°‘éšæœºæ¢ç´¢
    "boundary": 0.05    // å‡å°‘è¾¹ç•Œæµ‹è¯•
  }
}
```

## æ—¥å¿—è§£è¯»

### æˆåŠŸç¤ºä¾‹

```
[Fuzzer] ğŸŒ± Using seed-driven generation with 2 attack seeds
[SeedGen] Param #0: Generated 45 variations (type=uint256)
[SeedGen] Param #1: Generated 28 variations (type=address)
[SeedGen] Total combinations generated: 300
[Fuzzer] Tested 300 combinations, found 15 valid
[Fuzzer] Found valid combination #1 with similarity 0.8234 (violations: 1)
[Fuzzer] Found valid combination #2 with similarity 0.8156 (violations: 1)
...
ğŸ’¾ é«˜ç›¸ä¼¼åº¦å‚æ•°å·²ä¿å­˜åˆ°: ./fuzzing_results/mic/high_sim_20250117_143052_0xa1b2c3d4.json
```

### é—®é¢˜è¯Šæ–­

**é—®é¢˜1: æ— æœ‰æ•ˆç»“æœ**
```
[SeedGen] Total combinations generated: 300
[Fuzzer] Tested 300 combinations, found 0 valid
```

**å¯èƒ½åŸå› **:
- é˜ˆå€¼è¿‡é«˜ â†’ é™ä½ `threshold` åˆ° 0.6
- ä¸å˜é‡è¿‡ä¸¥ â†’ æ£€æŸ¥ä¸å˜é‡é…ç½®
- ç§å­å€¼ä¸å‡†ç¡® â†’ éªŒè¯æ”»å‡»å‚æ•°æ˜¯å¦æ­£ç¡®

**é—®é¢˜2: ç§å­æœªç”Ÿæ•ˆ**
```
[Fuzzer] Using default random generation
```

**å¯èƒ½åŸå› **:
- `seed_config.enabled` æœªè®¾ç½®ä¸º `true`
- `attack_seeds` ä¸ºç©ºæˆ–æ ¼å¼é”™è¯¯
- é…ç½®æ–‡ä»¶è·¯å¾„é”™è¯¯

## æœ€ä½³å®è·µ

### 1. ç§å­æ•°æ®æ”¶é›†

ä»çœŸå®æ”»å‡»äº¤æ˜“ä¸­æå–å‚æ•°:

```bash
# ä½¿ç”¨ cast å·¥å…·è§£æäº¤æ˜“
cast tx 0x<æ”»å‡»äº¤æ˜“å“ˆå¸Œ> --rpc-url <RPC_URL>

# è§£æ calldata
cast 4byte-decode <calldata>
```

### 2. æ¸è¿›å¼è°ƒä¼˜

ä»ä¸¥æ ¼é…ç½®å¼€å§‹,é€æ­¥æ”¾å®½:

```
ç¬¬1è½®: threshold=0.8, max_variations=200
  â†“ å¦‚æœç»“æœè¿‡å°‘
ç¬¬2è½®: threshold=0.7, max_variations=300
  â†“ å¦‚æœä»ç„¶ä¸è¶³
ç¬¬3è½®: threshold=0.65, max_variations=500
```

### 3. å¤šç§å­ç­–ç•¥

å¦‚æœæ”»å‡»æœ‰å¤šä¸ªå˜ç§,æä¾›å¤šä¸ªç§å­:

```json
{
  "attack_seeds": {
    "0": [
      "1000000000000000000",
      "2000000000000000000",
      "5000000000000000000"
    ]
  }
}
```

### 4. éªŒè¯ç»“æœ

æŸ¥çœ‹ä¿å­˜çš„é«˜ç›¸ä¼¼åº¦å‚æ•°æ–‡ä»¶:

```bash
cat ./fuzzing_results/mic/high_sim_*.json | jq '.high_similarity_results[0]'
```

ç¡®è®¤å‚æ•°èŒƒå›´ç¬¦åˆé¢„æœŸã€‚

## æ•…éšœæ’é™¤

### ç¼–è¯‘é”™è¯¯

å¦‚æœé‡åˆ°ç¼–è¯‘é”™è¯¯:

```bash
cd autopath
go mod tidy
go build -o monitor ./cmd/monitor
```

### é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯

éªŒè¯ JSON æ ¼å¼:

```bash
cat pkg/invariants/configs/mic_seed.json | jq .
```

### Monitor è¿æ¥å¤±è´¥

æ£€æŸ¥ Anvil æ˜¯å¦è¿è¡Œ:

```bash
curl -X POST -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}' \
  http://localhost:8545
```

## ä¸‹ä¸€æ­¥: Layer 2-5

Layer 1 ç§å­é©±åŠ¨æ¨¡ç³Šæµ‹è¯•å·²å°±ç»ªã€‚åç»­ä¼˜åŒ–æ–¹å‘:

- **Layer 2**: è‡ªé€‚åº”èŒƒå›´ç¼©æ”¾ - æ ¹æ®ç›¸ä¼¼åº¦åŠ¨æ€è°ƒæ•´å˜å¼‚èŒƒå›´
- **Layer 3**: ç¬¦å·æ‰§è¡Œ - ä½¿ç”¨ç¬¦å·æ‰§è¡Œå¼•å¯¼å‚æ•°ç”Ÿæˆ
- **Layer 4**: æ¢¯åº¦å¼•å¯¼ - åˆ©ç”¨ç›¸ä¼¼åº¦æ¢¯åº¦ä¼˜åŒ–å‚æ•°æœç´¢
- **Layer 5**: æ··åˆæ¨¡å¼ - ç»“åˆç¬¦å·å’Œå…·ä½“æ‰§è¡Œ

å½“å‰ Layer 1 å·²èƒ½æ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯éœ€æ±‚,å»ºè®®å…ˆéªŒè¯æ•ˆæœåå†å†³å®šæ˜¯å¦å®æ–½åç»­å±‚çº§ã€‚
